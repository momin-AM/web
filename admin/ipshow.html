<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Visitor IP Log ‚Äì Momin's Adda</title>
  <style>
    body {
      background-color: #000;
      color: #00ffff;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      background-color: #111;
      padding: 15px;
      text-align: center;
      font-size: 1.5rem;
      border-bottom: 1px solid #333;
    }

    .log-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .entry {
      margin-bottom: 10px;
      padding: 10px;
      border-left: 4px solid #00ffcc;
      background-color: #111;
      border-radius: 8px;
    }

    .timestamp {
      font-size: 0.85rem;
      color: #888;
      margin-top: 4px;
    }

    .back-btn {
      background-color: #00ffff;
      color: #000;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      margin: 10px;
      cursor: pointer;
      align-self: flex-start;
    }

    .back-btn:hover {
      background-color: #f107f1;
    }
    .top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background-color: #111;
  border-bottom: 1px solid #333;
}

.back-btn, .delete-btn {
  background-color: #00ffff;
  color: #000;
  font-weight: bold;
  border: none;
  border-radius: 4px;
  padding: 8px 12px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.back-btn:hover {
  background-color: #f107f1;
}

.delete-btn {
  background-color: crimson;
}

.delete-btn:hover {
  background-color: #ff4d4d;
}
  </style>
</head>
<body>

  <header>Visitor Log Panel</header>
  <div class="top-bar">
  <button class="back-btn" onclick="location.href='admin.html'">‚Üê Back to Home</button>
  <span id="visitorCount" style="color: #ccc; font-weight: bold;">Total visitors: ...</span>
  <button id="deleteAllBtn" class="delete-btn">üî• Delete All</button>
</div>

  <div class="log-container" id="logContainer">
    <!-- Visitor entries will appear here -->
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      orderBy,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDqJE28QQCt0KovRewpFWxgXd_7WIqmFEM",
      authDomain: "momin-chat-33997.firebaseapp.com",
      projectId: "momin-chat-33997",
      storageBucket: "momin-chat-33997.appspot.com",
      appId: "1:583120424404:web:79a60a30d07afadf5c9a41"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const logContainer = document.getElementById("logContainer");
    const visitorCount = document.getElementById("visitorCount");

    const q = query(collection(db, "visitors"));

onSnapshot(query(collection(db, "visitors")), (snapshot) => {
  logContainer.innerHTML = "";

  const logs = [];

  snapshot.forEach((doc) => {
    const data = doc.data();
    const { ip, date, time } = data;

    if (!ip || !date || !time) return;

    // Convert date to ISO format (yyyy-mm-dd), assuming date is in dd/mm/yyyy or mm/dd/yyyy
    const [part1, part2, part3] = date.split("/");
    const isMonthFirst = parseInt(part1) <= 12; // Guess format

    const isoDate = isMonthFirst
      ? `${part3}-${part1.padStart(2, "0")}-${part2.padStart(2, "0")}`
      : `${part3}-${part2.padStart(2, "0")}-${part1.padStart(2, "0")}`;

    const fullTime = time.toUpperCase().includes("AM") || time.toUpperCase().includes("PM")
      ? time
      : `${time}`; // assume 24-hour fallback

    const sortKey = new Date(`${isoDate} ${fullTime}`);

    logs.push({ ip, date, time, sortKey });
  });

  // Sort based on constructed Date object
  logs.sort((a, b) => a.sortKey - b.sortKey);

  if (logs.length === 0) {
    logContainer.innerHTML = `<div class="entry">üïµÔ∏è‚Äç‚ôÇÔ∏è No visitor logs available.</div>`;
    console.warn("‚ö†Ô∏è No valid logs to display.");
    return;
  }

  logs.forEach(({ ip, date, time }) => {
    const div = document.createElement("div");
    div.className = "entry";
    div.innerHTML = `
      <div><strong>IP:</strong> ${ip}</div>
      <div class="timestamp">${date} ${time}</div>
    `;
    logContainer.appendChild(div);
  });
  const uniqueIPs = new Set();
snapshot.forEach((doc) => {
  const data = doc.data();
  if (data.ip) uniqueIPs.add(data.ip);
});
visitorCount.textContent = `Total visitors: ${uniqueIPs.size}`;

  logContainer.scrollTop = logContainer.scrollHeight;
});
    import {
  deleteDoc,
  getDocs,
  doc
} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

document.getElementById("deleteAllBtn").onclick = async function () {
  const inputPass = prompt("Enter admin password to delete logs:");
  if (inputPass !== "momin1234") {
    alert("‚ùå Incorrect password. Access denied.");
    return;
  }

  const snapshot = await getDocs(collection(db, "visitors"));
  const deletions = snapshot.docs.map((d) => deleteDoc(doc(db, "visitors", d.id)));

  await Promise.all(deletions);
  alert("‚úÖ All visitor logs deleted successfully.");
};
  </script>

</body>
</html>